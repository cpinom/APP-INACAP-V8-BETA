<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button text="Portafolio" defaultHref="/dashboard-alumno/portafolio"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>

  <ion-list inset="true" class="card-list">
    <ion-item detail="false">
      <ion-icon slot="start" src="assets/icon/school.svg" class="rounded variant-3"></ion-icon>
      <ion-label>
        <h2>Avance Programa de Estudios</h2>
        <p>Sigue tu avance académico. Consulta tu progreso, tutor asignado y recursos de apoyo disponibles.</p>
      </ion-label>
    </ion-item>
  </ion-list>

  @if (mostrarCargando) {
  <div class="loaderInacap">
    <ion-spinner name="lines" color="primary"></ion-spinner>
  </div>
  }

  <ng-container *ngIf="mostrarData && data">

    <section class="accesos-directos">
      <div class="section-header">Otros Accesos</div>
      <div class="section-content">
        <ion-row>
          <ion-col size="6">
            <ion-button class="color-1">
              <div class="btn-inner">
                <ion-icon src="assets/icon/table_chart.svg" class="rounded"></ion-icon>
                <ion-label>
                  <h2>Malla Curricular</h2>
                </ion-label>
                <ion-icon src="assets/icon/arrow_forward.svg" class="launch"></ion-icon>
              </div>
            </ion-button>
          </ion-col>
          <ion-col size="6">
            <ion-button class="color-2">
              <div class="btn-inner">
                <ion-icon src="assets/icon/report_gmailerrorred.svg" class="rounded"></ion-icon>
                <ion-label>
                  <h2>Riesgos Académicos</h2>
                </ion-label>
                <ion-icon src="assets/icon/arrow_forward.svg" class="launch"></ion-icon>
              </div>
            </ion-button>
          </ion-col>
        </ion-row>
      </div>
    </section>

    <!-- RIESGOS -->
    <!-- <section class="riesgos first">
      <div class="section-header">Riesgos Académicos</div>
      <div class="section-content">
        <ion-accordion-group expand="inset">
          <ion-accordion value="first">
            <ion-item slot="header">
              <ion-row>
                <ion-col>
                  <ng-container *ngIf="!poseeRA">
                    <ion-icon color="success" src="assets/icon/check_circle.svg"></ion-icon>
                    <span class="verde">Sin problemas de Asistencia</span>
                  </ng-container>
                  <ng-container *ngIf="poseeRA">
                    <ion-icon color="danger" src="assets/icon/highlight_off.svg"></ion-icon>
                    <span class="rojo">Asistencia baja</span>
                  </ng-container>
                </ion-col>
                <ion-col>
                  <ng-container *ngIf="!poseeRN">
                    <ion-icon color="success" src="assets/icon/check_circle.svg"></ion-icon>
                    <span class="verde">Sin problemas de Calificaciones</span>
                  </ng-container>
                  <ng-container *ngIf="poseeRN">
                    <ion-icon color="danger" src="assets/icon/highlight_off.svg"></ion-icon>
                    <span class="rojo">Calificaciones bajas</span>
                  </ng-container>
                </ion-col>
              </ion-row>
            </ion-item>
            <div class="table-content" slot="content">
              <table class="table">
                <thead>
                  <tr>
                    <th class="ion-text-left">Asignatura</th>
                    <th>Riesgo Asistencia</th>
                    <th>Riesgo Nota</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of data.riesgosAcademicos">
                    <td class="ion-text-left">{{item.asigTdesc}}</td>
                    <td>
                      <ion-icon *ngIf="item.riesgoasistencia == 0" color="success"
                        src="assets/icon/check_circle.svg"></ion-icon>
                      <ion-icon *ngIf="item.riesgoasistencia != 0" color="danger"
                        src="assets/icon/highlight_off.svg"></ion-icon>
                    </td>
                    <td>
                      <ion-icon *ngIf="item.riesgonota == 0" color="success"
                        src="assets/icon/check_circle.svg"></ion-icon>
                      <ion-icon *ngIf="item.riesgonota != 0" color="danger"
                        src="assets/icon/highlight_off.svg"></ion-icon>
                    </td>
                  </tr>
                  <tr *ngIf="data.riesgosAcademicos.length == 0">
                    <td colspan="3" class="ion-text-center">Sin registros...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </ion-accordion>
        </ion-accordion-group>
      </div>
    </section> -->

    <!-- EFICIENCIA -->
    <section class="eficiencia-acad">
      <div class="section-header">Eficiencia Académica</div>
      <div class="section-content">
        <div class="table-content">
          <table class="table">
            <thead>
              <tr>
                <th>Cursos</th>
                <th *ngFor="let item of data.eficienciaAcad">{{item.periodo}}</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Inscritos</td>
                <td *ngFor="let item of data.eficienciaAcad">{{item.inscritos}}</td>
              </tr>
              <tr>
                <td>Aprobados</td>
                <td *ngFor="let item of data.eficienciaAcad">{{item.aprobadas}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- AVANCES MALLA -->
    <section>
      <div class="section-header">Estado de Avance de la Malla</div>
      <div class="section-content">
        <div class="table-content">
          <table class="table">
            <thead>
              <tr>
                <th colspan="2">Requisitos de Titulación</th>
                <th>Cumplimiento</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of data.avanceMalla">
                <td>{{item.reqTitulacion}}</td>
                <td>{{item.reqTitulacionPonderado}}</td>
                <td>
                  <ion-icon *ngIf="item.cumplimiento == 1" color="success"
                    src="assets/icon/check_circle.svg"></ion-icon>
                  <ion-icon *ngIf="item.cumplimiento == 0" color="danger"
                    src="assets/icon/highlight_off.svg"></ion-icon>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- TUTOR -->
    <section *ngIf="data.tutorAsignado">
      <div class="section-header">Tutor Asignado</div>
      <div class="section-content">
        <ion-list>
          <ion-item lines="full">
            <app-cached-image slot="start" [src]="resolverFoto(data.tutorAsignado.codigotutor)"></app-cached-image>
            <ion-label>
              <h2>{{data.tutorAsignado.nombretutor | titleCase}}</h2>
              <p>{{data.tutorAsignado.correo}}</p>
            </ion-label>
          </ion-item>
          <!-- <ion-item>
            <ion-label>{{data.tutorAsignado.horarioTutor}}</ion-label>
          </ion-item> -->
          <ion-item>
            <ion-label>
              <p>{{data.tutorAsignado.nota}}</p>
            </ion-label>
            <ion-button slot="end" fill="outline" size="small" color="primary" (click)="apoyoTutor()">Solicitar
              Reunión</ion-button>
          </ion-item>
          <ion-item routerLink="acuerdo-tutorial" detail="true">
            <ion-label>Acuerdo Atención Tutorial</ion-label>
            <ion-badge color="danger" *ngIf="status && status.acuerdoTutorial == 0">1</ion-badge>
          </ion-item>
        </ion-list>
      </div>
    </section>

    <!-- CURSOS DE APOYO -->
    <section *ngIf="data.cursosApoyo.length">
      <div class="section-header">Cursos de Apoyo Realizados</div>
      <div class="section-content table-content">
        <table class="table">
          <thead>
            <tr>
              <th>Código</th>
              <th>Nombre</th>
              <th>Período</th>
              <th>Tipo</th>
              <th>Nota</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of data.cursosApoyo">
              <td>{{item.asigCcod}}</td>
              <td>{{item.asigTdesc}}</td>
              <td>{{item.periodo}}</td>
              <td>{{item.tasgTdesc}}</td>
              <td>{{item.nota}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- PLATAFORMAS -->
    <section *ngIf="data && data.plataformasApoyo.length > 0">
      <div class="section-header">Plataformas de Apoyo</div>
      <div class="section-content">
        <ion-list>
          <ion-item *ngFor="let item of data.plataformasApoyo">
            <ion-label>{{item.pagenTdesc}}</ion-label>
            <ion-button slot="end" fill="outline" size="small" color="primary"
              (click)="abrirPlataforma(item.pagenTcampolibre1)">Ingresar</ion-button>
          </ion-item>
        </ion-list>
      </div>
    </section>

  </ng-container>

  <section *ngIf="mostrarData && !data" class="empty-state">
    <div>
      <ion-icon src="assets/icon/info.svg"></ion-icon>
      <p>Información no disponible en este momento.</p>
      <ion-button color="primary" shape="round" (click)="recargar()">Recargar</ion-button>
    </div>
  </section>

</ion-content>